schema: '2.0'
stages:
  filter_by_frequency:
    cmd: python3 src/data/filter_by_frequency.py
    deps:
    - path: data/raw/loc-brightkite_totalCheckins.txt
      md5: afeb1b5472c391929b6de33724e9ac98
      size: 382119602
    - path: src/data/filter_by_frequency.py
      md5: 7a9f241398e9496c0b752639ac9130b0
      size: 1417
    params:
      params.yaml:
        filter.required_unique_places: 5
        filter.required_unique_visitors: 10
    outs:
    - path: data/interim/filtered_by_frequency.csv
      md5: c6a5c284c3c653ecced5bfdfe81d6112
      size: 43631685
  categorize_geoposition:
    cmd: python3 src/features/categorize_geoposition.py
    deps:
    - path: data/interim/filtered_by_frequency.csv
      md5: c6a5c284c3c653ecced5bfdfe81d6112
      size: 43631685
    - path: src/features/categorize_geoposition.py
      md5: fd4adb0d7bd5f6e97e10df656ae7f0a4
      size: 701
    params:
      params.yaml:
        geoposition.round_precision: 2
    outs:
    - path: data/interim/categorical_geoposition.csv
      md5: 62f5fa21d210e4d1034481cda961080d
      size: 6726855
  label_encode:
    cmd: python3 src/features/label_encode.py
    deps:
    - path: data/interim/categorical_geoposition.csv
      md5: 62f5fa21d210e4d1034481cda961080d
      size: 6726855
    - path: data/interim/filtered_by_frequency.csv
      md5: c6a5c284c3c653ecced5bfdfe81d6112
      size: 43631685
    - path: src/features/label_encode.py
      md5: 03f5ad5b2987e8ba2604b80f23c6fdae
      size: 1078
    outs:
    - path: artifacts/label_encoders.pkl
      md5: b2faaa45f50ed611e0f56df5de8f70bb
      size: 248030
    - path: data/interim/label_encoded.csv
      md5: f1f6d37a2e9f14ded474f30d29806203
      size: 29567611
  group_and_compute_distances:
    cmd: python3 src/features/group_and_compute_distances.py
    deps:
    - path: data/interim/label_encoded.csv
      md5: f1f6d37a2e9f14ded474f30d29806203
      size: 29567611
    - path: src/features/group_and_compute_distances.py
      md5: 344c9cb8d367fc283e46e3fedead845f
      size: 969
    outs:
    - path: data/interim/grouped_by_user_with_distances.csv
      md5: 305ed01957def186badb5d69fddae855
      size: 41431311
  split_data:
    cmd: python3 src/features/split_data.py
    deps:
    - path: data/interim/grouped_by_user_with_distances.csv
      md5: 305ed01957def186badb5d69fddae855
      size: 41431311
    - path: src/features/split_data.py
      md5: f5c662226fe5790555a6a3d1567f7dad
      size: 763
    params:
      params.yaml:
        split.random_state: 0
        split.test_size: 0.3
    outs:
    - path: data/processed/test.csv
      md5: bb50f45f27a1d29d0f98ece808e4d6fc
      size: 12093925
    - path: data/processed/train.csv
      md5: 22866b5f3a0ac569fc9c077928d3f3b2
      size: 28121239
  train_lstm:
    cmd: python3 src/models/lstm/train.py
    deps:
    - path: artifacts/label_encoders.pkl
      md5: b2faaa45f50ed611e0f56df5de8f70bb
      size: 248030
    - path: data/processed/train.csv
      md5: 22866b5f3a0ac569fc9c077928d3f3b2
      size: 28121239
    - path: src/models/lstm/data.py
      md5: 79adf097e34c837bcdb9fe67bca08ede
      size: 3194
    - path: src/models/lstm/model.py
      md5: f71586b27b1c324def7788b768181a29
      size: 4251
    - path: src/models/lstm/train.py
      md5: b1a46f324a88f43c3362fd0eb07dae3e
      size: 955
    params:
      params.yaml:
        lstm:
          data:
            max_sequence_length: 100
            batch_size_train: 4
            batch_size_valid: 32
          model:
            embedding_dim: 64
            hidden_dim: 64
            num_layers: 1
            dropout: 0.0
          optimizer:
            learning_rate: 0.001
            epochs: 1
    outs:
    - path: artifacts/lstm.ckpt
      md5: 074d501320542b22fdd09687f1a32880
      size: 2643205
    - path: logs
      md5: 425cf56ecd879793b318192517113db4.dir
      size: 424
      nfiles: 5
