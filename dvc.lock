schema: '2.0'
stages:
  filter_by_frequency:
    cmd: python3 src/data/filter_by_frequency.py
    deps:
    - path: data/raw/loc-brightkite_totalCheckins.txt
      md5: afeb1b5472c391929b6de33724e9ac98
      size: 382119602
    - path: src/data/filter_by_frequency.py
      md5: 7a9f241398e9496c0b752639ac9130b0
      size: 1417
    params:
      params.yaml:
        filter.required_unique_places: 5
        filter.required_unique_visitors: 10
    outs:
    - path: data/interim/filtered_by_frequency.csv
      md5: c6a5c284c3c653ecced5bfdfe81d6112
      size: 43631685
  categorize_geoposition:
    cmd: python3 src/features/categorize_geoposition.py
    deps:
    - path: data/interim/filtered_by_frequency.csv
      md5: c6a5c284c3c653ecced5bfdfe81d6112
      size: 43631685
    - path: src/features/categorize_geoposition.py
      md5: fd4adb0d7bd5f6e97e10df656ae7f0a4
      size: 701
    params:
      params.yaml:
        geoposition.round_precision: 2
    outs:
    - path: data/interim/categorical_geoposition.csv
      md5: 62f5fa21d210e4d1034481cda961080d
      size: 6726855
  label_encode:
    cmd: python3 src/features/label_encode.py
    deps:
    - path: data/interim/categorical_geoposition.csv
      md5: 62f5fa21d210e4d1034481cda961080d
      size: 6726855
    - path: data/interim/filtered_by_frequency.csv
      md5: c6a5c284c3c653ecced5bfdfe81d6112
      size: 43631685
    - path: src/features/label_encode.py
      md5: 03f5ad5b2987e8ba2604b80f23c6fdae
      size: 1078
    outs:
    - path: artifacts/label_encoders.pkl
      md5: bc55ffe0e9a7cef1633db30e705119d9
      size: 248034
    - path: data/interim/label_encoded.csv
      md5: 607d9e8eee2c8c400f1682f2fbeb0210
      size: 29603713
  group_and_compute_distances:
    cmd: python3 src/features/group_and_compute_distances.py
    deps:
    - path: data/interim/label_encoded.csv
      md5: 607d9e8eee2c8c400f1682f2fbeb0210
      size: 29603713
    - path: src/features/group_and_compute_distances.py
      md5: 344c9cb8d367fc283e46e3fedead845f
      size: 969
    outs:
    - path: data/interim/grouped_by_user_with_distances.csv
      md5: 7890f5016a6ab06e621413fa80e963a7
      size: 40252964
  split_data:
    cmd: python3 src/features/split_data.py
    deps:
    - path: data/interim/grouped_by_user_with_distances.csv
      md5: 7890f5016a6ab06e621413fa80e963a7
      size: 40252964
    - path: src/features/split_data.py
      md5: f5c662226fe5790555a6a3d1567f7dad
      size: 763
    params:
      params.yaml:
        split.random_state: 0
        split.test_size: 0.3
    outs:
    - path: data/processed/test.csv
      md5: 9c638af5f73eb061eedd9af18e8d4638
      size: 12106759
    - path: data/processed/train.csv
      md5: e12dfcdd06eab37aa99e146aa1b0b3f2
      size: 28124770
  train_lstm:
    cmd: python3 src/models/lstm/train.py
    deps:
    - path: artifacts/label_encoders.pkl
      md5: bc55ffe0e9a7cef1633db30e705119d9
      size: 248034
    - path: data/processed/train.csv
      md5: e12dfcdd06eab37aa99e146aa1b0b3f2
      size: 28124770
    - path: src/models/lstm/data.py
      md5: 79adf097e34c837bcdb9fe67bca08ede
      size: 3194
    - path: src/models/lstm/model.py
      md5: dee5d5a33312ec66d3bb5932fcdaa8d3
      size: 4275
    - path: src/models/lstm/train.py
      md5: d66455d622d4c57e16940e8adad9037d
      size: 1152
    params:
      params.yaml:
        lstm:
          data:
            max_sequence_length: 100
            batch_size_train: 16
            batch_size_valid: 64
          model:
            embedding_dim: 64
            hidden_dim: 64
            num_layers: 3
            dropout: 0.0
          optimizer:
            learning_rate: 0.001
            epochs: 200
    outs:
    - path: artifacts/lstm.ckpt
      md5: dd64c1ab211676aad39c9f6762e21a6d
      size: 3447157
    - path: logs
      md5: a2bdf0818135d6a3da047ba6528d5a9b.dir
      size: 38549
      nfiles: 5
  split_data_by_time:
    cmd: python3 src/features/split_data_by_time.py
    deps:
    - path: data/interim/grouped_by_user_with_distances.csv
      md5: 305ed01957def186badb5d69fddae855
      size: 41431311
    - path: src/features/split_data_by_time.py
      md5: b6f16b96a5c88469f75fd05d4e60c926
      size: 771
    params:
      params.yaml:
        split.time_based_train_size: 0.8
    outs:
    - path: data/interim/time_based_split_test.csv
      md5: 44eff84b85260edf111b100649025560
      size: 7651288
    - path: data/interim/time_based_split_train.csv
      md5: b8fb70c9392c90e580f8a550b0d2ca91
      size: 32563876
